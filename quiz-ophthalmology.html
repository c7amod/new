<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Terminology Quiz — Ophthalmology</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { transition: opacity 600ms ease; }
    body.page-enter { opacity: 0; }
    body.page-enter-active { opacity: 1; }
    .reveal-on-scroll { opacity: 0; transform: translateY(10px); transition: opacity 600ms ease, transform 600ms ease; }
    .reveal-active { opacity: 1; transform: translateY(0); }
    .nav-anim { position: relative; }
    .nav-anim::after { content: ""; position: absolute; right: 0; bottom: -4px; height: 2px; width: 0; background: rgb(79 70 229); transition: width 300ms ease; }
    .nav-anim:hover::after { width: 100%; }
    .ltr { direction: ltr; text-align: left; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 page-enter">
  <header class="bg-white border-b border-slate-200 sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between relative">
      <div class="flex items-center gap-2">
        <a href="index.html" aria-label="العودة للصفحة الرئيسية" class="absolute left-3 md:-left-3 lg:-left-4 top-1/2 -translate-y-1/2 inline-flex items-center">
          <img src="assets/clearmed.png" alt="ClearMed banner" class="h-10 w-auto object-contain"/>
        </a>
      </div>
      <nav class="flex items-center gap-4 sm:gap-6 absolute right-3 sm:right-4 top-1/2 -translate-y-1/2">
        <a href="index.html" class="hover:text-indigo-600 nav-anim">الرئيسية</a>
        <a href="terminology.html#tests" class="hover:text-indigo-600 nav-anim">الاختبارات</a>
      </nav>
    </div>
  </header>
  
  <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="mb-6">
      <h1 class="text-2xl font-bold mb-2 ltr">Ophthalmology</h1>
      <p class="text-slate-700">اختر الإجابة الصحيحة لكل سؤال ثم اضغط "إنهاء الاختبار" لعرض الدرجة ومراجعة الإجابات.</p>
      <div class="mt-2 text-sm text-slate-600">الوقت: <span id="liveTimer">00:00</span></div>
    </div>

    <div id="quizContainer" class="space-y-4"></div>

    <div class="mt-6 flex flex-wrap items-center gap-3">
      <button id="submitBtn" class="rounded-lg bg-indigo-600 text-white px-5 py-2 hover:bg-indigo-700 transition-transform hover:-translate-y-0.5">إنهاء الاختبار</button>
      <button id="retryBtn" class="rounded-lg border px-5 py-2 hover:bg-slate-50 hidden">إعادة المحاولة</button>
      <label class="inline-flex items-center gap-2 text-sm hidden" id="filterWrap">
        <input type="checkbox" id="showOnlyIncorrect" class="rounded border-slate-300" />
        <span>عرض الأسئلة الخاطئة فقط</span>
      </label>
      <div id="scoreBox" class="text-sm text-slate-700 hidden"></div>
      <a href="terminology.html#tests" class="ml-auto rounded-lg border px-5 py-2 hover:bg-slate-50">الرجوع إلى قائمة الاختبارات</a>
    </div>
  </main>
  <footer class="border-t bg-white mt-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-slate-600 text-left">© 2025 clearmed.site</div>
  </footer>
  <script>
    // Page enter + start timer + remember source
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(() => {
        document.body.classList.add('page-enter-active');
        document.body.classList.remove('page-enter');
      });
      try {
        const t = Date.now();
        sessionStorage.setItem('quiz_start', String(t));
        sessionStorage.setItem('quiz_last_source', 'quiz-ophthalmology.html');
      } catch(_) {}
      try { startLiveTimer(Date.now()); } catch(_) {}
    });
    window.addEventListener('pageshow', () => {
      document.body.classList.add('page-enter-active');
      document.body.classList.remove('page-enter');
    });

    // Quiz data (Ophthalmology)
    const questions = [
      { id: 'q1', text: 'Patient suffering from pain in the eye, he should go to:', choices: ['Otologist', 'Psychiatrist', 'Surgeon', 'Ophthalmologist'], answer: 3 },
      { id: 'q2', text: 'Diplopia is:', choices: ['Double vision', 'Shortsightedness', 'Multiple visions', 'None of the above'], answer: 0 },
      { id: 'q3', text: 'Dacryocystitis is inflammation of:', choices: ['Middle ear', 'Inner ear', 'Sclera', 'Lacrimal gland'], answer: 3 },
      { id: 'q4', text: 'Patient has progressive decreasing in the visual activity, this condition may be due to:', choices: ['Cataract', 'Gynecomastia', 'Tracheomalacia', '—'], answer: 0 },
      { id: 'q5', text: 'Plastic operation of the cornea is called:', choices: ['Laryngeoplasty', 'Keratoplasty', 'Phacoemulsification', 'Dacryoplasty'], answer: 1 },
      { id: 'q6', text: 'When the eyes are pointing inside this is called:', choices: ['Exotropia', 'Esotropia', 'Hypertropia', 'Hypotropia'], answer: 1 },
      { id: 'q7', text: 'Ophthalmitis means:', choices: ['Inflammation of the eye', 'Inflammation of the ear', 'Inflammation of the liver', 'Inflammation of the nose'], answer: 0 },
      { id: 'q8', text: 'Nearsightedness equals:', choices: ['Hyperopia', 'Myopia', 'Diplopia', 'Presbyopia'], answer: 1 },
      { id: 'q9', text: 'Blepharoptosis means:', choices: ['Upward displacement of eyelid', 'Proposed eyelid', 'Downward displacement of eyelid', 'Both B and C'], answer: 3 },
      { id: 'q10', text: 'Ultrasonic treatment to remove cataract is called:', choices: ['Presbyopia', 'Strabismus', 'Coreometer', 'Phacoemulsification'], answer: 3 },
      { id: 'q11', text: 'The hard outer coat of the eye is called:', choices: ['Iris', 'Sclera', 'Cornea', 'None of them'], answer: 1 },
      { id: 'q12', text: 'Iridoplegia equals… Of iris', choices: ['Paralysis', 'Force', 'Inflammation', 'None of them'], answer: 0 },
      { id: 'q13', text: '… Is an instrument for measuring the pupil', choices: ['Coreometer', 'Electrocardiogram', 'Phacoemulsification', 'None of them'], answer: 0 },
      { id: 'q14', text: 'Keratotomy means:', choices: ['Incision of retina', 'Incision of cornea', 'Excision of cornea', 'Excision of retina'], answer: 1 },
      { id: 'q15', text: 'Cycloplegia means paralysis of…', choices: ['Retina', 'Ciliary body', 'Cornea', 'Iris'], answer: 1 },
      { id: 'q16', text: 'Lacrimotomy means…. Of lacrimal sac', choices: ['Excision', 'Incision', 'Surgical removal', 'Options A and C'], answer: 1 },
      { id: 'q17', text: '… Is making small incisions into the cornea to improve vision in myopia', choices: ['Keratoplasty', 'Radial keratotomy', 'Phacoemulsification', 'Options A and B'], answer: 1 },
      { id: 'q18', text: '… Is a disease in the eye due to increased intraocular pressure', choices: ['Cataract', 'Glaucoma', 'Retinitis', 'Cycloplegia'], answer: 1 },
      { id: 'q19', text: 'Blepharitis means inflammation of:', choices: ['Eyelid', 'Conjunctiva', 'Cornea', 'Iris'], answer: 0 },
      { id: 'q20', text: 'Dacry/o means:', choices: ['Cornea', 'Tears', 'Scelera', 'Iris'], answer: 1 },
      { id: 'q21', text: 'Blepharo is.....while phaco is.....', choices: ['eyelid, crystalline lens', 'Iris, crystalline lens', 'Cornea, eyelid', 'Crystalline lens, eyelid'], answer: 1 },
      { id: 'q22', text: 'Exotropia refers to:', choices: ['Eyes pointing outward', 'Eyes pointing inward', 'Eyes pointing upward', 'Eyes pointing downward'], answer: 0 },
      { id: 'q23', text: 'Which of the following is not a part of the eye?', choices: ['Iris', 'Cochlea', 'Conjunctiva', 'Retina'], answer: 1 },
      { id: 'q24', text: 'Squint is a condition affecting the:', choices: ['Middle ear', 'Sigmoid colon', 'Eye', 'Visceral muscles'], answer: 2 },
    ];

    function renderQuiz() {
      const wrap = document.getElementById('quizContainer');
      wrap.innerHTML = '';
      const letters = ['A', 'B', 'C', 'D'];
      questions.forEach((q, qi) => {
        const card = document.createElement('div');
        card.className = 'rounded-lg border bg-white p-4 card-enter';
        card.dataset.qid = q.id;
        const head = document.createElement('div');
        head.className = 'flex items-start justify-between gap-3 mb-3';
        head.innerHTML = `<div class=\"font-semibold\"></div><div class=\"hidden\" data-role=\"badge\"></div>`;
        card.appendChild(head);
        const text = document.createElement('div');
        text.className = 'mb-3 ltr';
        text.textContent = `${qi + 1}- ${q.text}`;
        card.appendChild(text);
        const ul = document.createElement('ul');
        ul.className = 'space-y-2';
        q.choices.forEach((c, ci) => {
          const li = document.createElement('li');
          li.innerHTML = `
            <label class=\"choice flex items-center gap-3 rounded border px-3 py-2 cursor-pointer\">\n              <input type=\"radio\" name=\"${q.id}\" value=\"${ci}\" class=\"peer\" />\n              <span class=\"opt-key\">${letters[ci] || ''}</span>\n              <span class=\"ltr grow\">${c}</span>\n            </label>`;
          ul.appendChild(li);
        });
        card.appendChild(ul);
        wrap.appendChild(card);
      });
    }

    function collectAnswers() {
      const answers = {};
      questions.forEach(q => {
        const checked = document.querySelector(`input[name=\"${q.id}\"]:checked`);
        answers[q.id] = checked ? parseInt(checked.value, 10) : null;
      });
      return answers;
    }

    function lockQuiz() { document.querySelectorAll('#quizContainer input[type=\"radio\"]').forEach(i=>i.disabled=true); }
    function unlockQuiz() { document.querySelectorAll('#quizContainer input[type=\"radio\"]').forEach(i=>i.disabled=false); }

    // Live timer UI
    let timerInterval = null;
    function startLiveTimer(startTs){
      const el = document.getElementById('liveTimer');
      if (!el) return;
      function render(now){
        const diff = Math.max(0, Math.floor((now - startTs)/1000));
        const m = String(Math.floor(diff/60)).padStart(2,'0');
        const s = String(diff%60).padStart(2,'0');
        el.textContent = `${m}:${s}`;
      }
      render(Date.now());
      timerInterval = setInterval(()=>render(Date.now()), 1000);
    }
    function stopLiveTimer(){ if (timerInterval) { clearInterval(timerInterval); timerInterval = null; } }

    function showResults(answers) {
      let correctCount = 0;
      questions.forEach(q => {
        const selected = answers[q.id];
        const card = document.querySelector(`[data-qid=\"${q.id}\"]`);
        const badge = card.querySelector('[data-role=\"badge\"]');
        badge.classList.remove('hidden');
        const options = card.querySelectorAll('label.choice');
        options.forEach((lab, idx) => {
          lab.classList.remove('correct','incorrect');
          if (idx === q.answer) lab.classList.add('correct');
          if (selected !== null && idx === selected && selected !== q.answer) lab.classList.add('incorrect');
        });
        if (selected === q.answer) { badge.className='badge badge-correct'; badge.textContent='✓'; correctCount++; }
        else { badge.className='badge badge-incorrect'; badge.textContent='✗'; }
      });
      const total = questions.length;
      const score = Math.round((correctCount/total)*100);
      const box = document.getElementById('scoreBox');
      box.classList.remove('hidden');
      box.textContent = `درجتك: ${correctCount} / ${total} (${score}%)`;
      document.getElementById('retryBtn').classList.remove('hidden');
      document.getElementById('filterWrap').classList.remove('hidden');
    }

    function applyIncorrectFilter(onlyIncorrect) {
      questions.forEach(q => {
        const card = document.querySelector(`[data-qid=\"${q.id}\"]`);
        const badge = card.querySelector('[data-role=\"badge\"]');
        const isIncorrect = badge && badge.classList.contains('badge-incorrect');
        card.style.display = onlyIncorrect && !isIncorrect ? 'none' : '';
      });
    }

    function resetQuiz() {
      renderQuiz();
      unlockQuiz();
      const box = document.getElementById('scoreBox');
      box.classList.add('hidden');
      box.textContent = '';
      document.getElementById('retryBtn').classList.add('hidden');
      document.getElementById('filterWrap').classList.add('hidden');
      document.getElementById('showOnlyIncorrect').checked = false;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Init
    renderQuiz();

    // Events
    document.getElementById('submitBtn').addEventListener('click', () => {
      const answers = collectAnswers();
      lockQuiz();
      stopLiveTimer();
      // Compute score summary
      let correctCount = 0;
      const total = questions.length;
      questions.forEach(q => {
        const checked = document.querySelector(`input[name=\"${q.id}\"]:checked`);
        if (checked && parseInt(checked.value,10) === q.answer) correctCount++;
      });
      const score = Math.round((correctCount/total)*100);
      // Duration
      let durationMs = null;
      try {
        const s = sessionStorage.getItem('quiz_start');
        const started = s ? Number(s) : Date.now();
        durationMs = Date.now() - started;
        sessionStorage.setItem('quiz_end', String(Date.now()));
        sessionStorage.setItem('quiz_last_duration', String(durationMs));
      } catch(_) {}
      // Title
      let title = document.querySelector('h1') ? document.querySelector('h1').innerText.trim() : 'Quiz';
      // Persist payload and answers, redirect
      try {
        const payload = { correctCount, total, score, durationMs, title };
        sessionStorage.setItem('quiz_answers', JSON.stringify(answers));
        sessionStorage.setItem('quiz_payload', JSON.stringify(payload));
      } catch(_) {}
      setTimeout(() => { window.location.href = 'quiz-result.html'; }, 240);
    });
    document.getElementById('retryBtn').addEventListener('click', resetQuiz);
    document.getElementById('showOnlyIncorrect').addEventListener('change', e => applyIncorrectFilter(e.target.checked));

    // Review mode: support returning from results page to highlight answers and filter
    (function maybeReview(){
      try {
        const mode = sessionStorage.getItem('quiz_review');
        const src = sessionStorage.getItem('quiz_last_source');
        if (!mode || src !== 'quiz-ophthalmology.html') return;
        const raw = sessionStorage.getItem('quiz_answers');
        const answers = raw ? JSON.parse(raw) : null;
        if (!answers) return;
        showResults(answers);
        lockQuiz();
        document.getElementById('filterWrap').classList.remove('hidden');
        if (mode === 'incorrect') {
          document.getElementById('showOnlyIncorrect').checked = true;
          applyIncorrectFilter(true);
        }
        sessionStorage.removeItem('quiz_review');
      } catch(_) {}
    })();
  </script>
</body>
</html>
