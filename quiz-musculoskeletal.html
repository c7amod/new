<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Terminology Quiz — Musculoskeletal System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { transition: opacity 600ms ease; }
    body.page-enter { opacity: 0; }
    body.page-enter-active { opacity: 1; }
    .reveal-on-scroll { opacity: 0; transform: translateY(10px); transition: opacity 600ms ease, transform 600ms ease; }
    .reveal-active { opacity: 1; transform: translateY(0); }
    .nav-anim { position: relative; }
    .nav-anim::after { content: ""; position: absolute; right: 0; bottom: -4px; height: 2px; width: 0; background: rgb(79 70 229); transition: width 300ms ease; }
    .nav-anim:hover::after { width: 100%; }
    .ltr { direction: ltr; text-align: left; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 page-enter">
  <header class="bg-white border-b border-slate-200 sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between relative">
      <div class="flex items-center gap-2">
        <a href="index.html" aria-label="العودة للصفحة الرئيسية" class="absolute left-3 md:-left-3 lg:-left-4 top-1/2 -translate-y-1/2 inline-flex items-center">
          <img src="assets/clearmed.png" alt="ClearMed banner" class="h-10 w-auto object-contain"/>
        </a>
      </div>
      <nav class="flex items-center gap-4 sm:gap-6 absolute right-3 sm:right-4 top-1/2 -translate-y-1/2">
        <a href="index.html" class="hover:text-indigo-600 nav-anim">الرئيسية</a>
        <a href="terminology.html#tests" class="hover:text-indigo-600 nav-anim">الاختبارات</a>
      </nav>
    </div>
  </header>
  
  <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="mb-6">
      <h1 class="text-2xl font-bold mb-2 ltr">Musculoskeletal System</h1>
      <p class="text-slate-700">اختر الإجابة الصحيحة لكل سؤال ثم اضغط "إنهاء الاختبار" لعرض الدرجة ومراجعة الإجابات.</p>
      <div class="mt-2 text-sm text-slate-600">الوقت: <span id="liveTimer">00:00</span></div>
    </div>

    <div id="quizContainer" class="space-y-4"></div>

    <div class="mt-6 flex flex-wrap items-center gap-3">
      <button id="submitBtn" class="rounded-lg bg-indigo-600 text-white px-5 py-2 hover:bg-indigo-700 transition-transform hover:-translate-y-0.5">إنهاء الاختبار</button>
      <button id="retryBtn" class="rounded-lg border px-5 py-2 hover:bg-slate-50 hidden">إعادة المحاولة</button>
      <label class="inline-flex items-center gap-2 text-sm hidden" id="filterWrap">
        <input type="checkbox" id="showOnlyIncorrect" class="rounded border-slate-300" />
        <span>عرض الأسئلة الخاطئة فقط</span>
      </label>
      <div id="scoreBox" class="text-sm text-slate-700 hidden"></div>
      <a href="terminology.html#tests" class="ml-auto rounded-lg border px-5 py-2 hover:bg-slate-50">الرجوع إلى قائمة الاختبارات</a>
    </div>
  </main>
  <footer class="border-t bg-white mt-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-slate-600 text-left">© 2025 clearmed.site</div>
  </footer>
  <script>
    // Page enter + start timer + remember source
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(() => {
        document.body.classList.add('page-enter-active');
        document.body.classList.remove('page-enter');
      });
      try {
        const t = Date.now();
        sessionStorage.setItem('quiz_start', String(t));
        sessionStorage.setItem('quiz_last_source', 'quiz-musculoskeletal.html');
      } catch(_) {}
      try { startLiveTimer(Date.now()); } catch(_) {}
    });
    window.addEventListener('pageshow', () => {
      document.body.classList.add('page-enter-active');
      document.body.classList.remove('page-enter');
    });

    // Quiz data (Musculoskeletal)
    const questions = [
      { id: 'q1', text: 'The membrane which covers the bone is called:', choices: ['Perichondrium', 'Periosteum', 'Pleura', 'Endosteum'], answer: 1 },
      { id: 'q2', text: 'Skeletal muscle is …….. while smooth muscle is………:', choices: ['Rhabdomyo – myocardio', 'Lieomyo – rhabdomyo', 'Myocardio – rhabdomyo', 'Rhabdomyo – lieomyo'], answer: 3 },
      { id: 'q3', text: 'A small serous sac between tendon and a bone is called:', choices: ['Bursa', 'Cost', 'Tendon', '—'], answer: 0 },
      { id: 'q4', text: 'Prosth means:', choices: ['Replacement', 'Artificial body', 'A&B', '—'], answer: 2 },
      { id: 'q5', text: 'The word myometrium refers to:', choices: ['Muscle of stomach', 'Muscle of uterus', 'Muscle of heart', '—'], answer: 1 },
      { id: 'q6', text: 'The type of muscle that covers the humerus bone is called:', choices: ['Leiomyo', 'Rhabdomyo', 'Myocardio', '—'], answer: 1 },
      { id: 'q7', text: 'The condition of softening the bone is called:', choices: ['Osteitis', 'Osteon', 'Osteomalacia', '—'], answer: 2 },
      { id: 'q8', text: 'The root refers to joint is called:', choices: ['Athero', 'Arthro', 'Artherio', '—'], answer: 1 },
      { id: 'q9', text: 'Inflammation of the joint is called:', choices: ['Artheritis', 'Osteitis', 'Arthritis', '—'], answer: 2 },
      { id: 'q10', text: 'Epiphysis is the growth upon the end of a ……… bone', choices: ['Short', 'Long', 'Both A and B', '—'], answer: 1 },
      { id: 'q11', text: 'Inflammation of the shock absorber–like structure protecting a tendon sliding over a bone is termed:', choices: ['Arthritis', 'Tendonitis', 'Bursitis', 'Osteitis'], answer: 2 },
      { id: 'q12', text: 'Specialist in straightening teeth is:', choices: ['Orthist', 'Dentist', 'Orthodontist', 'Physician'], answer: 2 },
      { id: 'q13', text: 'Prosthesis is:', choices: ['Srerilization of body', 'Removal of organ', 'Healing of injury', 'Artificial replacement of destroyed organ'], answer: 3 },
      { id: 'q14', text: 'Excision of bones of the fingers is:', choices: ['Phalangectomy', 'Phalangotomy', 'Phalangoscopy', 'Phalangitis'], answer: 0 },
      { id: 'q15', text: 'Humeral related to bone of the………', choices: ['Ribs', 'Skull', 'Upper limb', 'Lower limb'], answer: 2 },
      { id: 'q16', text: 'Femur is related to bone of…………', choices: ['Upper limb', 'Lower limb', 'Vertebral column', 'Skull'], answer: 1 },
      { id: 'q17', text: 'A medical root that means bone', choices: ['Arthro', 'Osteo', 'Burso', 'Chondro'], answer: 1 },
    ];

    function renderQuiz() {
      const wrap = document.getElementById('quizContainer');
      wrap.innerHTML = '';
      const letters = ['A', 'B', 'C', 'D'];
      questions.forEach((q, qi) => {
        const card = document.createElement('div');
        card.className = 'rounded-lg border bg-white p-4 card-enter';
        card.dataset.qid = q.id;
        const head = document.createElement('div');
        head.className = 'flex items-start justify-between gap-3 mb-3';
        head.innerHTML = `<div class=\"font-semibold\"></div><div class=\"hidden\" data-role=\"badge\"></div>`;
        card.appendChild(head);
        const text = document.createElement('div');
        text.className = 'mb-3 ltr';
        text.textContent = `${qi + 1}- ${q.text}`;
        card.appendChild(text);
        const ul = document.createElement('ul');
        ul.className = 'space-y-2';
        q.choices.forEach((c, ci) => {
          const li = document.createElement('li');
          li.innerHTML = `
            <label class=\"choice flex items-center gap-3 rounded border px-3 py-2 cursor-pointer\">\n              <input type=\"radio\" name=\"${q.id}\" value=\"${ci}\" class=\"peer\" />\n              <span class=\"opt-key\">${letters[ci] || ''}</span>\n              <span class=\"ltr grow\">${c}</span>\n            </label>`;
          ul.appendChild(li);
        });
        card.appendChild(ul);
        wrap.appendChild(card);
      });
    }

    function collectAnswers() {
      const answers = {};
      questions.forEach(q => {
        const checked = document.querySelector(`input[name=\"${q.id}\"]:checked`);
        answers[q.id] = checked ? parseInt(checked.value, 10) : null;
      });
      return answers;
    }

    function lockQuiz() { document.querySelectorAll('#quizContainer input[type=\"radio\"]').forEach(i=>i.disabled=true); }
    function unlockQuiz() { document.querySelectorAll('#quizContainer input[type=\"radio\"]').forEach(i=>i.disabled=false); }

    // Live timer UI
    let timerInterval = null;
    function startLiveTimer(startTs){
      const el = document.getElementById('liveTimer');
      if (!el) return;
      function render(now){
        const diff = Math.max(0, Math.floor((now - startTs)/1000));
        const m = String(Math.floor(diff/60)).padStart(2,'0');
        const s = String(diff%60).padStart(2,'0');
        el.textContent = `${m}:${s}`;
      }
      render(Date.now());
      timerInterval = setInterval(()=>render(Date.now()), 1000);
    }
    function stopLiveTimer(){ if (timerInterval) { clearInterval(timerInterval); timerInterval = null; } }

    function showResults(answers) {
      let correctCount = 0;
      questions.forEach(q => {
        const selected = answers[q.id];
        const card = document.querySelector(`[data-qid=\"${q.id}\"]`);
        const badge = card.querySelector('[data-role=\"badge\"]');
        badge.classList.remove('hidden');
        const options = card.querySelectorAll('label.choice');
        options.forEach((lab, idx) => {
          lab.classList.remove('correct','incorrect');
          if (idx === q.answer) lab.classList.add('correct');
          if (selected !== null && idx === selected && selected !== q.answer) lab.classList.add('incorrect');
        });
        if (selected === q.answer) { badge.className='badge badge-correct'; badge.textContent='✓'; correctCount++; }
        else { badge.className='badge badge-incorrect'; badge.textContent='✗'; }
      });
      const total = questions.length;
      const score = Math.round((correctCount/total)*100);
      const box = document.getElementById('scoreBox');
      box.classList.remove('hidden');
      box.textContent = `درجتك: ${correctCount} / ${total} (${score}%)`;
      document.getElementById('retryBtn').classList.remove('hidden');
      document.getElementById('filterWrap').classList.remove('hidden');
    }

    function applyIncorrectFilter(onlyIncorrect) {
      questions.forEach(q => {
        const card = document.querySelector(`[data-qid=\"${q.id}\"]`);
        const badge = card.querySelector('[data-role=\"badge\"]');
        const isIncorrect = badge && badge.classList.contains('badge-incorrect');
        card.style.display = onlyIncorrect && !isIncorrect ? 'none' : '';
      });
    }

    function resetQuiz() {
      renderQuiz();
      unlockQuiz();
      const box = document.getElementById('scoreBox');
      box.classList.add('hidden');
      box.textContent = '';
      document.getElementById('retryBtn').classList.add('hidden');
      document.getElementById('filterWrap').classList.add('hidden');
      document.getElementById('showOnlyIncorrect').checked = false;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Init
    renderQuiz();

    // Events
    document.getElementById('submitBtn').addEventListener('click', () => {
      const answers = collectAnswers();
      lockQuiz();
      stopLiveTimer();
      // Compute score summary
      let correctCount = 0;
      const total = questions.length;
      questions.forEach(q => {
        const checked = document.querySelector(`input[name=\"${q.id}\"]:checked`);
        if (checked && parseInt(checked.value,10) === q.answer) correctCount++;
      });
      const score = Math.round((correctCount/total)*100);
      // Duration
      let durationMs = null;
      try {
        const s = sessionStorage.getItem('quiz_start');
        const started = s ? Number(s) : Date.now();
        durationMs = Date.now() - started;
        sessionStorage.setItem('quiz_end', String(Date.now()));
        sessionStorage.setItem('quiz_last_duration', String(durationMs));
      } catch(_) {}
      // Title
      let title = document.querySelector('h1') ? document.querySelector('h1').innerText.trim() : 'Quiz';
      // Persist payload and answers, redirect
      try {
        const payload = { correctCount, total, score, durationMs, title };
        sessionStorage.setItem('quiz_answers', JSON.stringify(answers));
        sessionStorage.setItem('quiz_payload', JSON.stringify(payload));
      } catch(_) {}
      setTimeout(() => { window.location.href = 'quiz-result.html'; }, 240);
    });
    document.getElementById('retryBtn').addEventListener('click', resetQuiz);
    document.getElementById('showOnlyIncorrect').addEventListener('change', e => applyIncorrectFilter(e.target.checked));

    // Review mode: support returning from results page to highlight answers and filter
    (function maybeReview(){
      try {
        const mode = sessionStorage.getItem('quiz_review');
        const src = sessionStorage.getItem('quiz_last_source');
        if (!mode || src !== 'quiz-musculoskeletal.html') return;
        const raw = sessionStorage.getItem('quiz_answers');
        const answers = raw ? JSON.parse(raw) : null;
        if (!answers) return;
        showResults(answers);
        lockQuiz();
        document.getElementById('filterWrap').classList.remove('hidden');
        if (mode === 'incorrect') {
          document.getElementById('showOnlyIncorrect').checked = true;
          applyIncorrectFilter(true);
        }
        sessionStorage.removeItem('quiz_review');
      } catch(_) {}
    })();
  </script>
</body>
</html>
