<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تسجيل الدخول — ClearMed</title>
  <link rel="icon" href="assets/lo.png" type="image/png" sizes="32x32" />
  <link rel="shortcut icon" href="assets/lo.png" type="image/png" />
  <link rel="apple-touch-icon" href="assets/lo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{overflow-x:hidden}
    body{transition:opacity 600ms ease}body.page-enter{opacity:0}body.page-enter-active{opacity:1}
    .reveal-on-scroll{opacity:0;transform:translateY(10px);transition:opacity 600ms ease,transform 600ms ease}
    .reveal-active{opacity:1;transform:translateY(0)}
  </style>
</head>
<body class="bg-slate-50 text-slate-800 page-enter min-h-screen flex flex-col">
  <header class="sticky top-0 z-20 bg-white/70 backdrop-blur border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between flex-row-reverse">
      <a href="index.html" class="flex items-center gap-3">
        <div class="leading-tight">
          <div class="font-extrabold text-slate-900">ClearMed</div>
        </div>
        <img src="assets/lo.png" alt="ClearMed" class="h-8 w-8 rounded-lg shadow"/>
      </a>
      <nav class="flex items-center gap-2 text-sm">
        <a href="index.html" class="nav-anim text-slate-700 hover:text-indigo-700">الرئيسية</a>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <section class="w-full reveal-on-scroll overflow-hidden">
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="pointer-events-none absolute -z-10 -top-10 -left-10 w-64 h-64 rounded-full bg-indigo-300/30 blur-3xl"></div>
        <div class="pointer-events-none absolute -z-10 top-24 right-0 w-72 h-72 rounded-full bg-emerald-300/25 blur-3xl"></div>
        <h1 class="text-2xl sm:text-3xl font-extrabold text-slate-900 text-center mb-6">تسجيل الدخول</h1>

        <form id="loginForm" class="bg-white rounded-2xl border shadow-sm p-5 sm:p-6 max-w-md mx-auto transition hover:shadow-lg">
          <h3 class="text-lg font-bold text-slate-800 mb-3">تسجيل الدخول</h3>
          <div class="space-y-3">
            <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" required class="w-full rounded-xl border px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
            <div class="relative">
              <input type="password" id="loginPassword" placeholder="كلمة المرور" required class="w-full rounded-xl border px-3 py-2.5 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
              <button type="button" id="togglePwLogin" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700" aria-label="إظهار/إخفاء كلمة المرور">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/></svg>
              </button>
            </div>
            <button type="submit" class="w-full rounded-xl bg-slate-900 text-white py-2.5 text-sm hover:bg-slate-800 transition">تسجيل الدخول</button>
            <p class="text-sm text-slate-600 mt-3 text-center">ليس لديك حساب؟ <a id="showSignup" href="#" class="font-semibold text-indigo-700 hover:underline">إنشاء حساب</a></p>
          </div>
        </form>

        <form id="registerForm" class="bg-white rounded-2xl border shadow-sm p-5 sm:p-6 max-w-md mx-auto mt-6 hidden transition hover:shadow-lg">
          <h3 class="text-lg font-bold text-slate-800 mb-3">إنشاء حساب</h3>
          <div class="space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <input type="text" id="firstName" placeholder="الاسم الأول" required class="w-full rounded-xl border px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
              <input type="text" id="lastName" placeholder="الاسم الثاني" required class="w-full rounded-xl border px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
            </div>
            <select id="batch" required class="w-full rounded-xl border px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200">
              <option value="" disabled selected>اختر الدفعة</option>
              <option value="2025-2030">2025-2030</option>
              <option value="2026-2031">2026-2031</option>
              <option value="2027-2032">2027-2032</option>
              <option value="2028-2033">2028-2033</option>
              <option value="2029-2034">2029-2034</option>
              <option value="2030-2035">2030-2035</option>
            </select>
            <input type="email" id="email" placeholder="البريد الإلكتروني" required class="w-full rounded-xl border px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
            <div class="relative">
              <input type="password" id="password" placeholder="كلمة المرور" required class="w-full rounded-xl border px-3 py-2.5 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
              <button type="button" id="togglePw" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700" aria-label="إظهار/إخفاء كلمة المرور">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/></svg>
              </button>
            </div>
            <div class="relative">
              <input type="password" id="confirmPassword" placeholder="تأكيد كلمة المرور" required class="w-full rounded-xl border px-3 py-2.5 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200" />
              <button type="button" id="togglePw2" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700" aria-label="إظهار/إخفاء تأكيد كلمة المرور">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/></svg>
              </button>
            </div>
            <button type="submit" class="w-full rounded-xl bg-indigo-600 text-white py-2.5 text-sm hover:bg-indigo-700 transition">إنشاء الحساب</button>
            <p class="text-sm text-slate-600 mt-3 text-center">لديك حساب؟ <a id="showLogin" href="#" class="font-semibold text-indigo-700 hover:underline">تسجيل دخول</a></p>
          </div>
        </form>

        <div id="welcome" style="display:none;" class="bg-white rounded-2xl border shadow-sm p-5 sm:p-6 max-w-md mx-auto mt-6 text-center">
          <p class="text-slate-800 text-lg">مرحبًا <span id="userName" class="font-bold"></span> 👋</p>
          <button id="logoutBtn" class="mt-3 rounded-xl border px-4 py-2 text-sm hover:bg-slate-50">تسجيل الخروج</button>
        </div>
        <div id="msgBox" class="hidden max-w-md mx-auto mt-4 rounded-xl border px-3 py-2 text-sm"></div>
      </div>
    </section>
  </main>

  <footer class="border-t bg-white mt-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-slate-600 flex flex-col sm:flex-row-reverse sm:items-center sm:justify-between gap-1">
      <div class="text-left">© 2025 clearmed.site</div>
      <div class="text-xs text-slate-400 ltr">Powered by Ahmed Omar</div>
    </div>
  </footer>
  

  <script>
    // __toggleTheme is defined in the head script
    document.addEventListener('DOMContentLoaded',function(){requestAnimationFrame(function(){document.body.classList.add('page-enter-active');document.body.classList.remove('page-enter');});});
    window.addEventListener('pageshow',function(){document.body.classList.add('page-enter-active');document.body.classList.remove('page-enter');});
    const io=new IntersectionObserver(function(e){e.forEach(function(t){if(t.isIntersecting){t.target.classList.add('reveal-active');io.unobserve(t.target);}})},{threshold:0.1});
    document.querySelectorAll('.reveal-on-scroll').forEach(function(el){io.observe(el)});
  </script>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // إعدادات مشروعك
    const firebaseConfig = {
      apiKey: "AIzaSyD1mEhqNWLDNisd1LVv2_KpfWm_evJTOkE",
      authDomain: "clearmed-f8d63.firebaseapp.com",
      databaseURL: "https://clearmed-f8d63-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "clearmed-f8d63",
      storageBucket: "clearmed-f8d63.appspot.com",
      messagingSenderId: "977064626525",
      appId: "1:977064626525:web:example"
    };

    // بدء Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // رسائل داخلية أنيقة
    function setMsg(text, type){
      const box = document.getElementById('msgBox');
      if(!box) return;
      if(!text){ box.classList.add('hidden'); box.textContent=''; return; }
      box.textContent = text;
      box.classList.remove('hidden');
      const ok = type === 'ok';
      box.className = 'max-w-md mx-auto mt-4 rounded-xl border px-3 py-2 text-sm ' + (ok ? 'bg-green-50 text-green-700 border-green-200' : 'bg-rose-50 text-rose-700 border-rose-200');
    }

    // عناصر الصفحة
    const registerForm = document.getElementById("registerForm");
    const loginForm = document.getElementById("loginForm");
    const welcomeDiv = document.getElementById("welcome");
    const userNameSpan = document.getElementById("userName");
    const logoutBtn = document.getElementById("logoutBtn");
    const showSignup = document.getElementById('showSignup');
    const showLogin = document.getElementById('showLogin');

    // إنشاء حساب جديد
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const batch = document.getElementById("batch").value;
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      if (!firstName || !lastName || !batch || !email || !password || !confirmPassword) { setMsg('من فضلك املأ كل الحقول', 'err'); return; }
      if (password !== confirmPassword) { setMsg('كلمتا المرور غير متطابقتين', 'err'); return; }
      if (password.length < 6) { setMsg('كلمة المرور يجب أن تكون 6 أحرف على الأقل', 'err'); return; }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await set(ref(db, "users/" + user.uid), {
          firstName,
          lastName,
          batch,
          email
        });

        window.location.replace('index-v2.html');
      } catch (error) {
        setMsg('خطأ: ' + error.message, 'err');
      }
    });

    // إظهار/إخفاء كلمات المرور + تغيير أيقونة العين
    const eyeOpenSvg = '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/></svg>';
    const eyeOffSvg  = '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/><path d="M2 2l20 20"/></svg>';

    function attachEyeToggle(btnId, inputId){
      const btn = document.getElementById(btnId);
      const input = document.getElementById(inputId);
      if(!btn || !input) return;
      // set initial icon (password hidden -> closed eye)
      btn.innerHTML = eyeOffSvg;
      btn.addEventListener('click', ()=>{
        const show = input.getAttribute('type') === 'password';
        input.setAttribute('type', show ? 'text' : 'password');
        // after toggle: if we are showing text now -> open eye, else closed eye
        btn.innerHTML = show ? eyeOpenSvg : eyeOffSvg;
      });
    }

    attachEyeToggle('togglePw', 'password');
    attachEyeToggle('togglePw2', 'confirmPassword');
    attachEyeToggle('togglePwLogin', 'loginPassword');

    // تسجيل الدخول
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      try {
        await signInWithEmailAndPassword(auth, email, password);
        window.location.replace('index-v2.html');
      } catch (error) {
        const code = (error && error.code) ? String(error.code) : '';
        if (code === 'auth/invalid-credential' || code === 'auth/wrong-password' || code === 'auth/user-not-found') {
          setMsg('اسم المستخدم أو كلمة المرور غير صحيحة', 'err');
        } else {
          setMsg('حدث خطأ أثناء تسجيل الدخول، حاول مرة أخرى لاحقًا', 'err');
        }
      }
    });

    // تسجيل الخروج
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      welcomeDiv.style.display = "none";
      registerForm.style.display = "none";
      loginForm.style.display = "block";
    });

    // التبديل بين تسجيل الدخول وإنشاء الحساب
    if (showSignup) {
      showSignup.addEventListener('click', function(e){ e.preventDefault(); loginForm.classList.add('hidden'); registerForm.classList.remove('hidden'); });
    }
    if (showLogin) {
      showLogin.addEventListener('click', function(e){ e.preventDefault(); registerForm.classList.add('hidden'); loginForm.classList.remove('hidden'); });
    }
  </script>
</body>
</html>
