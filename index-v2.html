<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ClearMed — الرئيسية (نسخة احترافية)</title>
  <link rel="icon" href="assets/lo.png" type="image/png" sizes="32x32" />
  <link rel="shortcut icon" href="assets/lo.png" type="image/png" />
  <link rel="apple-touch-icon" href="assets/lo.png" />
  <!-- Theme color for mobile browser UI (updated dynamically) -->
  <meta name="theme-color" content="#0b1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Early theme set to avoid FOUC -->
  <script>
    (function(){
      try {
        const ls = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (ls === 'dark' || (!ls && prefersDark)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      } catch(e) {}
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          keyframes: {
            shine: {
              '0%': { transform: 'translateX(-150%)' },
              '100%': { transform: 'translateX(150%)' }
            }
          },
          animation: {
            shine: 'shine 1.3s ease-in-out'
          }
        }
      }
    }
  </script>
  <script>
    // Ensure the mobile status bar color follows the current theme
    function applyThemeColor() {
      var meta = document.querySelector('meta[name="theme-color"]');
      if (!meta) return;
      // Always use the site's dark base to avoid white top/bottom bars on mobile
      meta.setAttribute('content', '#0b1220');
    }
    // Apply on load
    applyThemeColor();
    // Expose a reliable toggle for inline usage (no transitions)
    window.__toggleTheme = function(){
      var root = document.documentElement;
      var nowDark = !root.classList.contains('dark');
      root.classList.toggle('dark', nowDark);
      try { localStorage.setItem('theme', nowDark ? 'dark' : 'light'); } catch(_){ }
      applyThemeColor();
    };
    // Hook theme toggle button if present
    document.addEventListener('DOMContentLoaded', function(){
      // click handled via inline onclick to avoid double-binding
      // Also respond to system scheme changes
      try {
        var mql = window.matchMedia('(prefers-color-scheme: dark)');
        mql.addEventListener('change', function(e){
          // If user hasn't explicitly chosen, follow system instantly
          var ls = null; try { ls = localStorage.getItem('theme'); } catch(_){ }
          if (!ls) {
            document.documentElement.classList.toggle('dark', e.matches);
          }
          applyThemeColor();
        });
      } catch(_){}
    });
  </script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <style>
    /* Page transitions */
    body { transition: opacity 500ms ease; }
    body.page-enter { opacity: 0; }
    body.page-enter-active { opacity: 1; }

    /* Scroll reveal */
    .reveal-on-scroll { opacity: 0; transform: translateY(10px); transition: opacity 600ms ease, transform 600ms ease; }
    .reveal-active { opacity: 1; transform: translateY(0); }

    /* Link underline animation */
    .nav-anim { position: relative; }
    .nav-anim::after { content: ""; position: absolute; right: 0; bottom: -4px; height: 2px; width: 0; background: rgb(79 70 229); transition: width 300ms ease; }
    .nav-anim:hover::after { width: 100%; }

    /* Glass effect helper (fallback safe) */
    .glass { background: rgba(255,255,255,0.55); border: 1px solid rgba(255,255,255,0.35); box-shadow: 0 10px 30px rgba(15,23,42,.08); }
    @supports (backdrop-filter: blur(8px)) {
      .glass { backdrop-filter: blur(12px); background: rgba(255,255,255,0.35); }
    }
    /* Intro cards stage (stacked) */
    /* On hover: bring hovered card front with outline; blur siblings slightly */
    #introStack > a { transition: transform .3s ease, filter .3s ease; z-index: 0; }
    #introStack:hover > a { filter: blur(1px) saturate(.99); z-index: 0; }
    #introStack > a:hover { transform: translateY(-8px) scale(1.06); z-index: 30; filter: drop-shadow(0 14px 36px rgba(0,0,0,.28)); }

    /* Base background colors (helps mobile system bars pick correct color) */
    html { background-color: #f8fafc; }
    body { background-color: #f8fafc; }
    .dark html { background-color: #0b1220; }
    .dark body { background-color: #0b1220; }

    /* Dark mode overrides */
    .dark body { color: #e5e7eb; }
    /* Use a smoother multi-stop gradient to avoid harsh banding */
    .dark body { background-image: linear-gradient(180deg, #0b1220 0%, #0c1424 45%, #0e1627 70%, #0f172a 100%) !important; }
    /* Prevent footer utility bg from creating a hard strip in dark mode */
    .dark footer { background-color: transparent !important; }
    .dark .glass { background: rgba(15,23,42,0.55); border-color: rgba(148,163,184,0.25); box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    /* Make the header solid in dark mode to avoid any light band under the system bar */
    .dark header .glass { background: #0b1220 !important; border-color: rgba(148,163,184,0.18) !important; box-shadow: none; }
    @supports (backdrop-filter: blur(8px)) {
      .dark .glass { backdrop-filter: blur(12px); background: rgba(15,23,42,0.35); }
    }
    .dark .bg-white { background-color: rgba(2,6,23,0.6) !important; }
    .dark .border { border-color: rgba(148,163,184,0.22) !important; }
    .dark .text-slate-900 { color: #f1f5f9 !important; }
    .dark .text-slate-800 { color: #e5e7eb !important; }
    .dark .text-slate-700 { color: #e2e8f0 !important; }
    .dark .text-slate-600, .dark .text-slate-500 { color: #cbd5e1 !important; }
    .dark .shadow-sm { box-shadow: 0 8px 20px rgba(0,0,0,.35) !important; }

    /* Global background visuals (cover whole page) */
    .site-bg {
      position: fixed; inset: 0; z-index: -10; pointer-events: none;
    }

    /* Safe area (iOS notch) */
    .safe-top { padding-top: env(safe-area-inset-top); padding-top: constant(safe-area-inset-top); }

    
  </style>
</head>
<body class="bg-gradient-to-b from-slate-50 via-white to-slate-50 text-slate-800 page-enter">
  <!-- Header -->
  <header class="sticky top-0 z-30 safe-top">
    <div class="glass">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between flex-row-reverse">
        <a href="index.html" class="flex items-center gap-3">
          <div class="leading-tight">
            <div class="font-extrabold text-slate-900">ClearMed</div>
          </div>
          <img src="assets/lo.png" alt="ClearMed" class="h-9 w-9 rounded-xl shadow"/>
        </a>
        <nav class="flex items-center gap-2 sm:gap-3 text-sm">
          <button id="themeToggle" type="button" aria-label="تبديل الوضع الليلي" onclick="__toggleTheme()" class="inline-flex items-center justify-center h-9 w-9 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800">
            <svg id="iconSun" class="w-5 h-5 hidden dark:inline" viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10 10h2v-3h-2v3zM4.22 19.78l1.79 1.8 1.79-1.8-1.79-1.79-1.79 1.79zM20 13h3v-2h-3v2zM12 1h2v3h-2V1zm7.78 3.84l-1.8-1.79-1.79 1.79 1.79 1.79 1.8-1.79zM12 7a5 5 0 100 10 5 5 0 000-10zm5.99 12.01l-1.79-1.79-1.8 1.79 1.8 1.8 1.79-1.8z"/></svg>
            <svg id="iconMoon" class="w-5 h-5 dark:hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
          </button>
          <a href="https://t.me/clearmedsite" target="_blank" aria-label="تيليجرام" title="تيليجرام" class="inline-flex items-center rounded-full p-2 bg-indigo-600 text-white hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-400">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9.04 15.29 8.9 19.1c.36 0 .52-.15.71-.33l1.7-1.63 3.52 2.58c.64.36 1.1.17 1.28-.59l2.32-10.86c.21-.96-.35-1.34-.97-1.1L4.3 10.1c-.93.36-.92.88-.16 1.12l3.6 1.12 8.37-5.29c.39-.26.74-.12.45.14"/></svg>
          </a>
          <span id="authSlot" class="inline-flex"></span>
        </nav>
      </div>
    </div>
  </header>

  <!-- Hero Intro with introImageStackRise -->
  <!-- Global background visuals -->
  <div class="site-bg">
    <div class="absolute -top-24 -left-24 w-72 h-72 rounded-full bg-indigo-200/40 dark:bg-indigo-500/15 blur-3xl"></div>
    <div class="absolute top-1/3 right-10 w-80 h-80 rounded-full bg-emerald-200/40 dark:bg-emerald-500/15 blur-3xl"></div>
    <div class="absolute bottom-0 left-1/4 w-96 h-96 rounded-full bg-indigo-100/40 dark:bg-indigo-400/10 blur-3xl"></div>
  </div>
  <section id="intro" class="relative overflow-hidden pt-4 sm:pt-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid lg:grid-cols-2 gap-8 items-center">
        <div class="order-1 lg:order-1 mt-6 sm:mt-10">
          <h1 id="heroTitle" class="text-3xl sm:text-4xl font-extrabold text-slate-900 mb-3">مرحبًا بك في ClearMed</h1>
          <p class="text-slate-600 mb-5">منصة تعليمية تجمع بين الفيديوهات والملفات والاختبارات التدريبية بأسلوب حديث وسلس، مع انتقالات وأنيميشن احترافية.</p>
          
          
        </div>
        <div class="order-2 lg:order-2 relative h-40 sm:h-52 md:h-[360px] mt-2 sm:mt-0">
          <!-- Stack container -->
          <div id="introStack" class="absolute inset-x-0 top-[42%] md:top-1/2 -translate-y-1/2 w-full max-w-3xl mx-auto grid grid-cols-3 place-items-center gap-8 px-4 md:gap-12">
            <!-- Card 1: Tests -->
            <a class="group relative w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-2xl glass flex flex-col items-center justify-center text-center transform-gpu will-change-transform shadow-xl">
              <div class="w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-xl bg-amber-500/10 text-amber-600 grid place-items-center mb-1 sm:mb-2">
                <svg viewBox="0 0 24 24" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6" fill="currentColor"><path d="M7 3h10a2 2 0 0 1 2 2v14l-7-3-7 3V5a2 2 0 0 1 2-2z"/></svg>
              </div>
              <div class="font-bold">اختبارات</div>
            </a>
            <!-- Card 2: Videos -->
            <a class="group relative w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-2xl glass flex flex-col items-center justify-center text-center transform-gpu will-change-transform shadow-xl">
              <div class="w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-xl bg-indigo-500/10 text-indigo-600 grid place-items-center mb-1 sm:mb-2">
                <svg viewBox="0 0 24 24" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
              </div>
              <div class="font-bold">فيديوهات</div>
            </a>
            <!-- Card 3: Files -->
            <a class="group relative w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-2xl glass flex flex-col items-center justify-center text-center transform-gpu will-change-transform shadow-xl">
              <div class="w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-xl bg-emerald-500/10 text-emerald-600 grid place-items-center mb-1 sm:mb-2">
                <svg viewBox="0 0 24 24" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16l4-2 4 2 4-2 4 2V8z"/></svg>
              </div>
              <div class="font-bold">ملفات</div>
            </a>
          </div>
        </div>
      </div>
    </div>
    
  </section>

  

  <!-- Modules Grid -->
  <section id="modules" class="py-6 sm:py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="ltr text-3xl sm:text-4xl font-extrabold tracking-tight text-center text-slate-900 mb-8">First year</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <a href="orientation.html" class="group relative rounded-2xl border bg-white p-5 overflow-hidden transition shadow-sm hover:shadow-lg transform-gpu hover:-translate-y-1">
          <div class="absolute pointer-events-none -inset-1 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition"></div>
          <div class="relative">
            <div class="font-semibold ltr text-lg sm:text-xl">1. Orientation</div>
            <div class="text-sm text-slate-500">المقدمة</div>
          </div>
        </a>
        <a href="foundation.html" class="group relative rounded-2xl border bg-white p-5 overflow-hidden transition shadow-sm hover:shadow-lg transform-gpu hover:-translate-y-1">
          <div class="absolute pointer-events-none -inset-1 rounded-2xl bg-gradient-to-r from-emerald-500/10 via-sky-500/10 to-indigo-500/10 opacity-0 group-hover:opacity-100 transition"></div>
          <div class="relative">
            <div class="font-semibold ltr text-lg sm:text-xl">2. Foundation</div>
            <div class="text-sm text-slate-500">الأساسيات</div>
          </div>
        </a>
        <a href="blood.html" class="group relative rounded-2xl border bg-white p-5 overflow-hidden transition shadow-sm hover:shadow-lg transform-gpu hover:-translate-y-1">
          <div class="absolute pointer-events-none -inset-1 rounded-2xl bg-gradient-to-r from-rose-500/10 via-amber-500/10 to-indigo-500/10 opacity-0 group-hover:opacity-100 transition"></div>
          <div class="relative">
            <div class="font-semibold ltr text-lg sm:text-xl">3. Blood</div>
            <div class="text-sm text-slate-500">قريبًا</div>
          </div>
        </a>
        <a href="musculoskeletal.html" class="group relative rounded-2xl border bg-white p-5 overflow-hidden transition shadow-sm hover:shadow-lg transform-gpu hover:-translate-y-1">
          <div class="absolute pointer-events-none -inset-1 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-violet-500/10 to-fuchsia-500/10 opacity-0 group-hover:opacity-100 transition"></div>
          <div class="relative">
            <div class="font-semibold ltr text-lg sm:text-xl">4. Musculoskeletal</div>
            <div class="text-sm text-slate-500">قريبًا</div>
          </div>
        </a>
        <a href="cardio.html" class="group relative rounded-2xl border bg-white p-5 overflow-hidden transition shadow-sm hover:shadow-lg transform-gpu hover:-translate-y-1">
          <div class="absolute pointer-events-none -inset-1 rounded-2xl bg-gradient-to-r from-sky-500/10 via-emerald-500/10 to-indigo-500/10 opacity-0 group-hover:opacity-100 transition"></div>
          <div class="relative">
            <div class="font-semibold ltr text-lg sm:text-xl">5. Cardio</div>
            <div class="text-sm text-slate-500">قريبًا</div>
          </div>
        </a>
      </div>
    </div>
  </section>

  <!-- Contact / Footer -->
  <section class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="rounded-2xl border bg-white p-5 sm:p-6">
        <h3 class="text-lg sm:text-xl font-extrabold tracking-tight mb-1.5 text-slate-900">للتواصل</h3>
        <p class="text-slate-600 text-sm mb-2">لو عندك أي مشكلة في الموقع أو اقتراح لتحسين المحتوى، يسعدنا تواصلك.</p>
        <a href="https://t.me/i77amod" target="_blank" rel="noopener" class="inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-sm bg-sky-50 border-sky-200 text-sky-700 hover:bg-sky-100 dark:bg-sky-500/10 dark:border-sky-400/30 dark:text-sky-200 dark:hover:bg-sky-500/20 dark:hover:border-sky-400/40">
          <svg class="w-4 h-4 text-sky-600 dark:text-sky-300" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9.04 15.29 8.9 19.1c.36 0 .52-.15.71-.33l1.7-1.63 3.52 2.58c.64.36 1.1.17 1.28-.59l2.32-10.86c.21-.96-.35-1.34-.97-1.1L4.3 10.1c-.93.36-.92.88-.16 1.12l3.6 1.12 8.37-5.29c.39-.26.74-.12.45.14"/></svg>
          <span class="ltr text-sky-700 font-semibold dark:text-sky-200">i77amod</span>
        </a>
      </div>
    </div>
  </section>

  <footer class="border-t bg-white/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-slate-600 flex flex-col sm:flex-row-reverse sm:items-center sm:justify-between gap-1">
      <div class="text-left">© 2025 clearmed.site</div>
      <div class="text-xs text-slate-400 ltr">Powered by Ahmed Omar</div>
    </div>
  </footer>
  
  <script>
    // Page fade-in
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(() => {
        document.body.classList.add('page-enter-active');
        document.body.classList.remove('page-enter');
      });
    });

    // Re-appear on bfcache restore
    window.addEventListener('pageshow', () => {
      document.body.classList.add('page-enter-active');
      document.body.classList.remove('page-enter');
    });

    // Scroll reveal
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('reveal-active');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.reveal-on-scroll').forEach(el => observer.observe(el));

    // GSAP introImageStackRise (stacked overlap)
    gsap.registerPlugin(ScrollTrigger);
    const cards = Array.from(document.querySelectorAll('#introStack > a'));
    // Ensure initial layout offset for stacking
    if (cards.length === 3) {
      const [c1, c2, c3] = cards;
      // Base layered positions (overlap)
      Object.assign(c1.style, { zIndex: 3 });
      Object.assign(c2.style, { zIndex: 2 });
      Object.assign(c3.style, { zIndex: 1 });
      gsap.set(c1, { xPercent: -85, y: 14, rotate: -6, scale: 0.96 });
      gsap.set(c2, { xPercent: 0,   y: 0,  rotate: 0,  scale: 1.0 });
      gsap.set(c3, { xPercent: 85,  y: 14, rotate: 6,  scale: 0.96 });

      const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });
      tl.to(c1, { y: -10, rotate: -2, scale: 1.02, duration: 0.7 }, 0)
        .to(c2, { y: -14, rotate: 0,  scale: 1.06, duration: 0.7 }, 0.08)
        .to(c3, { y: -8,  rotate: 2,  scale: 1.02, duration: 0.7 }, 0.16)
        .from(cards, { boxShadow: 0, stagger: 0.05, duration: 0.4 }, 0.15);

      // Gentle floating loop (kept lightweight)
      gsap.to(c2, { y: '-=6', duration: 2.5, repeat: -1, yoyo: true, ease: 'sine.inOut' });
      gsap.to([c1, c3], { y: '+=5', duration: 3.2, repeat: -1, yoyo: true, ease: 'sine.inOut', delay: 0.6 });

      // No mouse parallax
    }

    // Enhanced interactivity for intro icons/cards
    (function enhanceIntroCards(){
      const root = document.getElementById('introStack');
      const cards = Array.from(document.querySelectorAll('#introStack > a'));
      if (!root || cards.length === 0) return;
      const finePointer = window.matchMedia('(pointer: fine)').matches;
      // Capture original transforms to restore later
      const orig = cards.map((c, i) => ({
        xPercent: gsap.getProperty(c, 'xPercent') || 0,
        rotate: gsap.getProperty(c, 'rotate') || 0,
        scale: gsap.getProperty(c, 'scale') || 1,
        z: c.style.zIndex || ''
      }));
      // Idle micro animations on icons
      cards.forEach((card, i) => {
        const icon = card.querySelector('svg');
        if (icon) {
          gsap.to(icon, { y: '+=4', duration: 1.6 + i * 0.25, repeat: -1, yoyo: true, ease: 'sine.inOut' });
          gsap.to(icon, { rotation: '+=2', duration: 2.4 + i * 0.3, repeat: -1, yoyo: true, ease: 'sine.inOut' });
        }
        // Shine sweep every few seconds
        const sweep = card.querySelector('.animate-shine');
        if (sweep) {
          gsap.fromTo(sweep, { x: '-150%' }, { x: '150%', duration: 1.15, ease: 'power2.inOut', repeat: -1, repeatDelay: 2 + i * 0.6 });
        }
      });

      if (!finePointer) return; // skip hover extras on touch
      // Lightweight hover (2D only)
      cards.forEach((card, idx) => {
        const icon = card.querySelector('svg');
        const qScale = gsap.quickTo(card, 'scale', { duration: 0.25, ease: 'power3' });

        // preserve original z-index to restore on leave
        if (!card.dataset.zorig) card.dataset.zorig = card.style.zIndex || '';

        card.addEventListener('pointerenter', () => {
          qScale(1.10);
          // bring hovered card to front and add stronger shadow
          card.style.zIndex = '10';
          gsap.to(card, {
            y: -6,
            boxShadow: '0 30px 80px rgba(79,70,229,0.28), 0 14px 40px rgba(15,23,42,0.25)',
            backgroundColor: 'rgba(255,255,255,0.55)',
            borderColor: 'rgba(255,255,255,0.6)',
            duration: 0.25,
            ease: 'power3.out'
          });
          if (icon) gsap.to(icon, { y: -10, scale: 1.08, filter: 'drop-shadow(0 6px 14px rgba(79,70,229,0.35))', duration: 0.45, ease: 'back.out(2)' });

          // Smoothly center hovered card, push siblings to sides
          const leftIdx = (idx + 2) % 3;
          const rightIdx = (idx + 1) % 3;
          const assignSide = (i, side) => {
            const conf = side === 'left' ? { xPercent: -85, rotate: -6, scale: 0.96 } : { xPercent: 85, rotate: 6, scale: 0.96 };
            cards[i].style.zIndex = side === 'left' ? '2' : '1';
            gsap.to(cards[i], { ...conf, duration: 0.35, ease: 'power3.out' });
          };
          gsap.to(card, { xPercent: 0, rotate: 0, duration: 0.35, ease: 'power3.out' });
          assignSide(leftIdx, 'left');
          assignSide(rightIdx, 'right');
        });
        card.addEventListener('pointerleave', () => {
          qScale(1);
          // restore original z-index and softer shadow
          card.style.zIndex = card.dataset.zorig;
          gsap.to(card, {
            y: 0,
            boxShadow: '0 10px 24px rgba(15,23,42,0.10)',
            backgroundColor: 'rgba(255,255,255,0.35)',
            borderColor: 'rgba(255,255,255,0.35)',
            duration: 0.3,
            ease: 'power3.out'
          });
          if (icon) gsap.to(icon, { y: 0, scale: 1, filter: 'none', duration: 0.5, ease: 'power3.out' });

          // Restore original layout for all three cards
          cards.forEach((c, i) => {
            c.style.zIndex = orig[i].z;
            gsap.to(c, {
              xPercent: orig[i].xPercent,
              rotate: orig[i].rotate,
              scale: orig[i].scale,
              duration: 0.35,
              ease: 'power3.out'
            });
          });
        });
      });
    })();


    // Smooth internal anchor scroll
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', (e) => {
        const id = a.getAttribute('href');
        if (!id || id === '#') return;
        e.preventDefault();
        document.querySelector(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });

    // Theme toggle handled via inline onclick="__toggleTheme()"
  </script>
  <script>
    // Firebase init (compat) — same project used in 11.html
    (function(){
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyD1mEhqNWLDNisd1LVv2_KpfWm_evJTOkE",
          authDomain: "clearmed-f8d63.firebaseapp.com",
          databaseURL: "https://clearmed-f8d63-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "clearmed-f8d63",
          storageBucket: "clearmed-f8d63.appspot.com",
          messagingSenderId: "977064626525",
          appId: "1:977064626525:web:example"
        };
        if (!firebase.apps || !firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
      } catch(_) {}
    })();
    (function setupAuthUI(){
      const authSlot = document.getElementById('authSlot');
      if (!authSlot || !window.firebase) return;
      const auth = firebase.auth();
      const db = firebase.database();
      function renderLogin(){
        authSlot.innerHTML = '<a href="login.html" class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 border border-slate-200 text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800">تسجيل الدخول</a>';
        try { var ht = document.getElementById('heroTitle'); if(ht) ht.textContent = 'مرحبًا بك في ClearMed'; } catch(_){ }
      }
      function renderHello(name){
        const safe = (name||'مستخدم').replace(/</g,'&lt;');
        authSlot.innerHTML = (
          '<div class="relative z-40">\n'
          + '  <button id="btnUserMenu" class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 bg-white border text-slate-700 hover:bg-slate-50 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-700 dark:hover:bg-slate-700">' 
          + '    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>'
          + '    <span class="font-medium">' + safe + '</span>'
          + '    <svg class="w-4 h-4 opacity-70" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>'
          + '  </button>\n'
          + '  <div id="userMenu" class="absolute left-0 mt-2 w-40 bg-white border rounded-xl shadow-lg hidden dark:bg-slate-800 dark:border-slate-700">\n'
          + '    <a href="#" id="menuLogout" class="block px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 dark:text-slate-200 dark:hover:bg-slate-700">تسجيل الخروج</a>\n'
          + '  </div>\n'
          + '</div>'
        );
        try { var ht = document.getElementById('heroTitle'); if(ht) ht.textContent = 'مرحبًا ' + safe; } catch(_){ }
        const btn = document.getElementById('btnUserMenu');
        const menu = document.getElementById('userMenu');
        const logout = document.getElementById('menuLogout');
        if (btn && menu){
          btn.addEventListener('click', function(e){
            e.stopPropagation();
            menu.classList.toggle('hidden');
          });
          document.addEventListener('click', function(){ menu.classList.add('hidden'); });
          document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ menu.classList.add('hidden'); }});
        }
        if (logout){
          logout.addEventListener('click', function(e){ e.preventDefault(); try { auth.signOut(); } catch(_){} });
        }
      }
      auth.onAuthStateChanged(function(user){
        if (!user) { renderLogin(); return; }
        try {
          var uid = user.uid;
          var email = user.email || '';
          db.ref('users/'+uid).once('value').then(function(s){
            var v = (s && s.val && s.val()) || {};
            // Prefer firstName if available, then username, then auth fallbacks
            var name = v.firstName || v.username || user.displayName || (email ? email.split('@')[0] : 'مستخدم');
            // Backfill to match original structure if missing
            if (!s.exists() || !v.username || !v.email) {
              db.ref('users/'+uid).update({ username: name, email: email }).catch(function(){});
            }
            renderHello(name);
          }).catch(function(){
            var fallback = user.displayName || (email ? email.split('@')[0] : 'مستخدم');
            // Best effort write
            db.ref('users/'+uid).update({ username: fallback, email: email }).catch(function(){});
            renderHello(fallback);
          });
        } catch(_) {
          var fallback = (user && (user.displayName || (user.email ? user.email.split('@')[0] : 'مستخدم'))) || 'مستخدم';
          renderHello(fallback);
        }
      });
    })();
  </script>
</body>
</html>
